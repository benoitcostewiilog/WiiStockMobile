<ion-content padding>

    <wii-main-loader [loading]="loading"></wii-main-loader>

    <ng-container *ngIf="!loading">
        <ion-grid>
            <ion-row>
                <ion-title *ngIf="anomalies && anomalies.length === 0 && !location">Aucune anomalie à traiter</ion-title>
            </ion-row>
            <ion-row>
                <ion-col col-1 offset-11>
                    <ion-icon *ngIf="location" name="backspace" (click)="backToLocations()" class="ion-float-right"></ion-icon>
                </ion-col>
            </ion-row>
        </ion-grid>

        <ion-title *ngIf="location"><ion-icon class="small-icon" name="pin"></ion-icon>   {{ location }}</ion-title>
        <ion-title *ngIf="location && anomalies && anomalies.length !== 0">
            <ion-icon class="big-icon" name="barcode" (click)="scanRef()"></ion-icon>
            <br>
            Flashez un article
        </ion-title>

        <ion-title *ngIf="anomalies && anomalies.length !== 0 && !location"><ion-icon class="big-icon" name="barcode" (click)="scanLocation()"></ion-icon><br>Flashez un emplacement</ion-title>

        <ion-badge *ngIf="anomaliesByLocation && anomaliesByLocation.length !== 0 && location">{{ anomaliesByLocation.length }}</ion-badge>
        <ion-badge *ngIf="locations && locations.length !== 0 && !location">{{ locations.length }}</ion-badge>

        <ion-list>
            <div *ngIf="location">
                <ion-grid>
                    <button class="list" ion-item *ngFor="let anomaly of anomaliesByLocation" id="{{anomaly.id}}">
                        <ion-row>
                            <ion-col>
                                <p>Référence : {{ anomaly.reference }}</p>
                                <p>Code barre : {{ anomaly.barcode }}</p>
                                <p>Quantité : {{ anomaly.quantity }}</p>
                            </ion-col>
                        </ion-row>
                    </button>
                </ion-grid>
            </div>
            <div *ngIf="!location">
                <ion-grid>
                    <button class="list" ion-item *ngFor="let location of locations">
                        <ion-row>
                            <ion-col>{{ location }}</ion-col>
                        </ion-row>
                    </button>
                </ion-grid>
            </div>
        </ion-list>
    </ng-container>
</ion-content>

<ion-footer padding *ngIf="!loading && !location">
    <div class="d-flex">
        <ion-icon class="big-icon" name="refresh" item-right (click)="synchronize()"></ion-icon>
    </div>
</ion-footer>
